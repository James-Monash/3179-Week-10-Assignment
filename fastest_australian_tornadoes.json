{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 900,
  "height": 600,
  "projection": {"type": "mercator", "center": [134, -28], "scale": 850},
  "background": "#e9f5fb",
  "title": {
    "text": "Top 5 Fastest Tornadoes by Wind Speed (Year range editable)",
    "anchor": "start",
    "fontSize": 20,
    "font": "Inter, Helvetica, Arial, sans-serif",
    "color": "#0b3d91",
    "fontWeight": "700"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/James-Monash/3179-Week-10-Assignment/main/tornado_with_wind_speed_data.csv",
    "format": {
      "type": "csv",
      "parse": {
        "Date/Time": "date:%d/%m/%Y %H:%M"
      }
    }
  },
  "params": [
    {
      "name": "Min_Year",
      "value": 1900,
      "bind": {
        "input": "range",
        "min": 1900,
        "max": 2025,
        "step": 1,
        "name": "Start Year: "
      }
    },
    {
      "name": "Max_Year",
      "value": 2025,
      "bind": {
        "input": "range",
        "min": 1900,
        "max": 2025,
        "step": 1,
        "name": "End Year: "
      }
    }
  ],
  "transform": [
    {"calculate": "toNumber(datum['Max speed (km/h)'])", "as": "MaxSpeed"},
    {"calculate": "isValid(datum['Date/Time']) ? datum['Date/Time'] : null", "as": "ParsedDate"},
    {"filter": "datum.ParsedDate !== null"},
    {"calculate": "year(datum.ParsedDate)", "as": "Year"},
    {"calculate": "toNumber(datum.Longitude)", "as": "lon"},
    {"calculate": "toNumber(datum.Latitude)", "as": "lat"},
    {
      "filter": "isFinite(datum.MaxSpeed) && isFinite(datum.lon) && isFinite(datum.lat) && (datum.Year >= Min_Year) && (datum.Year <= Max_Year)"
    },
    {
      "window": [
        {"op": "row_number", "as": "rownum"}
      ],
      "sort": [
        {"field": "MaxSpeed", "order": "descending"},
        {"field": "ParsedDate", "order": "ascending"},
        {"field": "Tornado ID", "order": "ascending"}
      ]
    },
    {"filter": "datum.rownum <= 5"}
  ],
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/James-Monash/3179-Week-10-Assignment/main/australia.json",
        "format": {"type": "topojson", "feature": "ne_50m_admin_1_states_provinces"}
      },
      "mark": {"type": "geoshape", "fill": "#f8f8fb", "stroke": "#b7c3d9", "strokeWidth": 0.9}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/James-Monash/3179-Week-10-Assignment/main/10_degree_graticules_for_australia.json",
        "format": {"type": "topojson", "feature": "ne_50m_graticules_10"}
      },
      "mark": {"type": "geoshape", "stroke": "#dfeaf5", "strokeWidth": 0.7}
    },
    {
      "mark": {"type": "image", "width": 42, "height": 42, "opacity": 0.98},
      "encoding": {
        "longitude": {"field": "lon", "type": "quantitative"},
        "latitude": {"field": "lat", "type": "quantitative"},
        "url": {
          "value": "https://raw.githubusercontent.com/James-Monash/3179-Week-10-Assignment/main/tornado.svg"
        },
        "tooltip": [
          {"title": "Date", "field": "Date/Time", "type": "temporal"},
          {"title": "Max wind speed", "field": "MaxSpeed", "type": "quantitative"}
        ]
      }
    },

    {
      "description": "Legend backdrop point (invisible) to anchor legend group location",
      "data": {"values": [{"lon": 153, "lat": -16}]},
      "mark": {"type": "point", "opacity": 0},
      "encoding": {
        "longitude": {"field": "lon", "type": "quantitative"},
        "latitude": {"field": "lat", "type": "quantitative"}
      }
    },

    {
      "description": "Legend items (text coloured by rating) positioned relative to anchor point",
      "data": {
        "values": [
          {"lon":153,"lat":-16,"label":"F0","color":"#7f8c8d","dy":-20,"dx":-60},
          {"lon":153,"lat":-16,"label":"F1","color":"#e07a1f","dy":-8,"dx":-60},
          {"lon":153,"lat":-16,"label":"F2","color":"#4aa3d9","dy":4,"dx":-60},
          {"lon":153,"lat":-16,"label":"F3","color":"#1e8a59","dy":16,"dx":-60},
          {"lon":153,"lat":-16,"label":"F4","color":"#f2d03a","dy":28,"dx":-60},
          {"lon":153,"lat":-16,"label":"F5","color":"#7b4ba6","dy":40,"dx":-60}
        ]
      },
      "mark": {"type": "text", "fontSize": 12, "font": "Inter, Helvetica, Arial, sans-serif", "align": "left"},
      "encoding": {
        "longitude": {"field": "lon", "type": "quantitative"},
        "latitude": {"field": "lat", "type": "quantitative"},
        "text": {"field": "label", "type": "nominal"},
        "color": {"field": "color", "type": "nominal", "legend": null}
      },
      "transform": [
        {"calculate": "datum.dx", "as": "offx"},
        {"calculate": "datum.dy", "as": "offy"}
      ]
    },

    {
      "description": "Dynamic Year labels placed top-right inside map area",
      "data": {"values":[{"lon":154.2,"lat":-12}]},
      "transform": [{"calculate": "Min_Year", "as": "minYear"}, {"calculate": "Max_Year", "as": "maxYear"}],
      "mark": {"type": "text", "fontSize": 12, "font": "Inter, Helvetica, Arial, sans-serif", "align":"left", "dx":6, "dy":-18, "color":"#08306b"},
      "encoding": {
        "longitude": {"field":"lon","type":"quantitative"},
        "latitude": {"field":"lat","type":"quantitative"},
        "text": {"expr":"'Start: ' + Min_Year"}
      }
    },

    {
      "data": {"values":[{"lon":154.2,"lat":-12}]},
      "transform": [{"calculate": "Min_Year", "as": "minYear"}, {"calculate": "Max_Year", "as": "maxYear"}],
      "mark": {"type": "text", "fontSize": 12, "font": "Inter, Helvetica, Arial, sans-serif", "align":"left", "dx":6, "dy":0, "color":"#08306b"},
      "encoding": {
        "longitude": {"field":"lon","type":"quantitative"},
        "latitude": {"field":"lat","type":"quantitative"},
        "text": {"expr":"'End: ' + Max_Year"}
      }
    }

  ],
  "config": {
    "legend": {"labelFont": "Inter, Helvetica, Arial, sans-serif", "titleFont": "Inter, Helvetica, Arial, sans-serif"},
    "title": {"font": "Inter, Helvetica, Arial, sans-serif"}
  }
}
